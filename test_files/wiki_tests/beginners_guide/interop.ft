use "utils.ft"

test "0_crash":
	str path = "wiki_tests/beginners_guide/interop/0_crash";
	str file = "main.ft";
	test_file_fail_in(path, file, "Parse Error at main.ft:1:1\n└─┬┤E0000│\n1 │ extern def hello();\n┌─┴─┘\n├─ Defined 'extern' function without the FIP running and active\n└─ Check your configs in '.fip/config/' to see if there are any problems with it\n");

test "1_still_crash":
	str path = "wiki_tests/beginners_guide/interop/1_still_crash";
	str file = "main.ft";
	// To emulate a missing installed fip-c module we just disable the module in the `fip.toml` file
	test_file_fail_in(path, file, "Parse Error at main.ft:1:1\n└─┬┤E0000│\n1 │ extern def hello();\n┌─┴─┘\n├─ Defined 'extern' function without the FIP running and active\n└─ Check your configs in '.fip/config/' to see if there are any problems with it\n");

test "2_hello":
	str path = "wiki_tests/beginners_guide/interop/2_hello";
	str file = "main.ft";
	test_file_ok_in(path, file, "Hello from C!\n");

test "3_signature_mismatch":
	str path = "wiki_tests/beginners_guide/interop/3_signature_mismatch";
	str file = "main.ft";
	test_file_fail_in(path, file, "[\x1B[31mMaster\x1B[0m]:  The function 'add' could not be resolved\nParse Error at main.ft:4:1\n└─┬┤E0000│\n4 │ extern def add(i32 x, i32 y) -> i32;\n┌─┴─┘\n└─ Extern function could not be found in any FIP module\n");

test "4_signature_ok":
	str path = "wiki_tests/beginners_guide/interop/4_signature_ok";
	str file = "main.ft";
	test_file_ok_in(path, file, "Hello from C!\nadd(1, 8) = 9\n");

test "5_data_passing":
	str path = "wiki_tests/beginners_guide/interop/5_data_passing";
	str file = "main.ft";
	test_file_ok_in(path, file, "md.(x, y, s, i) = (10, 10, 3.2, false)\nmd.(x, y, s, i) = (12, 15, 1.6, true)\n");

test "6_name_doesnt_matter":
	str path = "wiki_tests/beginners_guide/interop/6_name_doesnt_matter";
	str file = "main.ft";
	test_file_fail_in(path, file, "Generation Error at main.ft:18:1\n└──┬┤E0000│\n18 │ extern def do_something(SomeData md) -> SomeData;\n┌──┴─┘\n├─ Defined extern function 'do_something' twice\n└─ It was first defined at main.ft:17:1\n");

test "7_multi_types":
	str path = "wiki_tests/beginners_guide/interop/7_multi_types";
	str file = "main.ft";
	test_file_ok_in(path, file, "res = (13.7, 69.100006, 40.48)\n");
